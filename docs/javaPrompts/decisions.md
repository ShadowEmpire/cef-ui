‚úÖ PHASE 6 ‚Äî FINAL DECISIONS (FUNCTIONAL INTEGRATION)

Objective:
Fully functional Java ‚Üî CEF integration.
Java drives UI behavior.
No security hardening.
No production concerns.

1Ô∏è‚É£ Process Model & Ownership

Java and CEF are separate OS processes

CEF is always a child process of Java

If Java exits/crashes ‚Üí CEF must exit

If user closes CEF ‚Üí CEF exits

CEF is relaunched only on explicit user action

Multiple CEF instances:

Prevented by convention

No enforcement in Phase 6

2Ô∏è‚É£ VuePress / Documentation Serving

VuePress content is prebuilt static files

Java owns:

Serving static files via embedded HTTP server

Binding to 127.0.0.1

Using ephemeral port

Restarting server on failure

CEF loads documentation via:

http://127.0.0.1:<ephemeral_port>/


Java notifies CEF:

Before server restart

After server restart

3Ô∏è‚É£ IPC Transport (Phase 6)

IPC transport: Local TCP

Bound to: 127.0.0.1 only

Port:

Chosen ephemerally by Java

Passed to CEF via argv

IPC is:

Request ‚Üí Response

Single-client (CEF only)

4Ô∏è‚É£ IPC Security (Phase 6)

‚ùå No TLS

‚ùå No authentication

‚ùå No token validation

‚ùå No encryption

‚úÖ IPC interfaces must support:

auth headers

tokens

signatures

checksums
(interfaces only, no implementation)

5Ô∏è‚É£ IPC Protocol & Message Format

JSON-based IPC

Mandatory envelope format:

{
  "protocolVersion": "1.0",
  "commandId": "uuid",
  "command": "COMMAND_NAME",
  "headers": {},
  "payload": {}
}


Explicit correlation IDs

Strict request ‚Üí response model

Protocol version enforced during handshake

6Ô∏è‚É£ IPC Handshake (Phase 6)

Java starts IPC server first

CEF connects and sends HANDSHAKE

Handshake validates:

Protocol version

Parent PID (CEF confirms Java PID)

If validation fails:

CEF must exit

7Ô∏è‚É£ Restart & Recovery (Phase 6)
CEF crash

Java detects process exit

Java relaunches CEF

Java restores last known page

VuePress server crash

Java restarts server

Java notifies CEF

Java reissues last page load command

Java restart

CEF exits immediately

8Ô∏è‚É£ Contextual Help & Routing

Context ‚Üí page mapping:

Generated by VuePress build

Loaded and owned by Java

Java is the single authority for page resolution

Java retries resolution 3‚Äì5 times

Fallback behavior:

Java sends fallback page

If Java fails repeatedly, CEF may locally load a predefined fallback page

CEF never owns mapping logic

9Ô∏è‚É£ JS ‚Üî IPC (Phase 6)

JS exists only for rendering

JS:

‚ùå Cannot send business commands

‚ùå Cannot control navigation

JS bridge plumbing may exist but is dormant

All UI behavior is driven by Java

10Ô∏è‚É£ Failure Visibility (Phase 6)

Default behavior:

Log internally

Show fallback page

User-visible errors:

Allowed only if recovery is impossible

11Ô∏è‚É£ Explicit Phase 6 Exclusions

‚ùå TLS
‚ùå Authentication
‚ùå Token enforcement
‚ùå Encryption
‚ùå Signing / checksum logic
‚ùå Observability tooling
‚ùå Packaging / installers
‚ùå Single-instance enforcement

üß≠ PHASE 7 ‚Äî FINAL DECISIONS (HARDENING & PRODUCTION)

Objective:
Harden, secure, and operationalize existing behavior.
No new functional features.

1Ô∏è‚É£ IPC Transport Security (Phase 7)

Transport switches from TCP ‚Üí WSS

Mutual TLS (mTLS) between Java and CEF

Certificates:

App-bundled

Initially self-signed

Later replaceable with commercial CA certs

Certificate pinning:

Optional

Configurable

2Ô∏è‚É£ Authentication & Session Model (Phase 7)

Session token model:

Combination of:

Java session‚Äìscoped

Time-limited validity

Periodic rotation

Token issuer:

Java-only

Token usage:

Required for IPC handshake

Validated on every message

3Ô∏è‚É£ Message Integrity & Replay Protection

Message protection:

TLS

Message signature

Checksum

Replay protection:

Sequence-number based

4Ô∏è‚É£ JS ‚Üî IPC Activation (Phase 7)

JS is allowed to:

Send READY / UI state

Request help refresh

Trigger navigation via JS UI controls

Java remains the authority

Java decides final navigation

JS is NOT allowed to:

Directly navigate without Java approval

Bypass Java routing logic

JS Failure Handling

Invalid JS input:

Report to Java

Log internally

Trigger controlled restart if required

5Ô∏è‚É£ Failure Visibility & UX (Phase 7)

Escalation ladder:

Internal logs

Fallback documentation page

Modal dialog (last resort only)

Diagnostics:

Full diagnostics bundle

Logs

IPC traces

Crash context

Version + config snapshot

6Ô∏è‚É£ Resilience & Restart Policy (Phase 7)

IPC drop:

CEF retries with exponential backoff

Java restart:

CEF exits immediately

Java remains the single authority

7Ô∏è‚É£ Packaging & Deployment

CEF installer:

Bundled inside Java installer

Installed automatically

Updates:

Full application update only

No independent component updates

8Ô∏è‚É£ Observability & Operations

Metrics:

Timings

Counters

Scope:

Local-only initially

External APM explicitly deferred but supported by design

9Ô∏è‚É£ Explicit Phase 7 Exclusions

‚ùå New functional UI behavior
‚ùå New navigation logic
‚ùå Feature expansion
‚ùå Multi-user auth systems
‚ùå External monitoring (for now)

üîí FINAL STATUS

‚úÖ Phase 6: Fully frozen

‚úÖ Phase 7: Fully frozen

‚úÖ No rework required between phases

‚úÖ Transport swap (TCP ‚Üí WSS) is non-breaking

‚úÖ JS activation is controlled and safe

‚úÖ Java remains the single authority throughout

------------------------------------------------------------------

# Role: You are a senior system architect and low-level implementation expert.

Context: We are implementing Phase 6 of a multi-phase Java ‚Üî CEF system.
- Phase 1‚Äì5 are COMPLETE and FROZEN.
- Phase-6 is functional integration only.
- Phase-7 is security, hardening, and production only and must NOT be touched.

## Phase-6 Objective (Frozen)

By the end of Phase-6:
- Java and CEF are fully functionally connected
- Java drives all UI behavior
- CEF is a restartable, redirectable UI process
- VuePress documentation replaces PDF flow
- No security, no TLS, no auth enforcement
- Phase-7 contains only hardening (no behavior)

### Hard Boundaries (MANDATORY)

You MUST NOT:
- Rework or redesign Phase-1‚Äì5 abstractions
- Introduce Phase-7 concerns (TLS, auth, signing, metrics, packaging)
- Add ‚Äútemporary hacks‚Äù
- Add UI business logic in JS
- Move authority away from Java
- If something feels like Phase-7 ‚Üí explicitly defer it.

### FINAL PHASE-6 DECISIONS (AUTHORITATIVE)

Process Model
- Java and CEF are separate OS processes
- CEF is always a child process of Java
- If Java exits ‚Üí CEF exits
- If user closes CEF ‚Üí CEF exits
- CEF relaunch only on explicit user action
- Multiple CEF instances prevented by convention only

VuePress / Docs
- VuePress content is prebuilt static files
- Java serves docs via embedded HTTP server
- Bound to 127.0.0.1
- Uses ephemeral port
- Java restarts server on crash
- Java notifies CEF before/after restart
- CEF loads: 

> http://127.0.0.1:<port>/

### IPC (Phase-6 Transport)
- Transport: Local TCP
- Bound to 127.0.0.1
- Port chosen by Java, passed to CEF via argv
- Single CEF client only
- Request ‚Üí Response model

#### IPC Security (Phase-6)
- No TLS
- No authentication
- No token validation
- No encryption
- IPC interfaces MUST reserve fields for:
    - auth headers
    - tokens
    - signatures
    - checksums - (interfaces only, no implementation)

#### IPC Protocol
- JSON envelope (mandatory):

``` 
{
  "protocolVersion": "1.0",
  "commandId": "uuid",
  "command": "COMMAND_NAME",
  "headers": {},
  "payload": {}
}
```
- Explicit command correlation
- Protocol version enforced during handshake

#### IPC Handshake
- Java starts IPC server first
- CEF connects and sends handshake
- Handshake validates:
    - protocolVersion
    - parent PID (CEF confirms Java PID)
- On failure ‚Üí CEF exits

#### Restart & Recovery
- CEF crash ‚Üí Java relaunches ‚Üí restores last page
- VuePress crash ‚Üí Java restarts ‚Üí resends last page
- Java restart ‚Üí CEF exits immediately

#### Contextual Help
- Context ‚Üí page mapping generated by VuePress build
- Mapping loaded and owned by Java
- Java retries resolution 3‚Äì5 times
- Java sends fallback page on failure
- If Java fails repeatedly, CEF may locally load a predefined fallback page
- CEF NEVER owns mapping logic

#### JS ‚Üî IPC (Phase-6)
- JS is render-only
- JS cannot:
    - send business commands
    - control navigation
- JS bridge plumbing may exist but is dormant
- Java drives all UI behavior

#### Failure Visibility
- Default:
    - Log internally
    - Show fallback page
- User-visible error only if recovery is impossible

#### Explicitly Out of Scope Until Phase-7
- TLS / WSS
- Authentication / tokens
- Signing / checksum logic
- Observability
- Metrics
- Packaging
- Single-instance enforcement

### EXPECTED FROM YOU
- Stay strictly within Phase-6
- Ask clarifying questions only if unavoidable
- Explicitly label:
    - Phase-6 behavior
    - Phase-7 deferrals
- Provide:
    - File-by-file implementation guidance
    - Minimal-change activation of existing Phase-1‚Äì5 code
- Do NOT introduce new architecture

## NEXT TASK
- wait for explicit instruction on which side: Java / CEF
