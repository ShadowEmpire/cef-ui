syntax = "proto3";

package phase6;

option java_package = "com.ui.cef_control.ipc.grpc";
option java_outer_classname = "Phase6Proto";

// Phase-6 IPC proto (MVP)
// - Unary RPCs only
// - Java runs the gRPC server; CEF is the client
// - Messages include lightweight metadata placeholders for Phase-7
// TODO (Phase-7): add fields for authentication/tokens and transport-level security hooks.

// Generic acknowledgement
message Ack {
  bool ok = 1;
  string message = 2;
  // placeholder metadata for Phase-7
  map<string, string> metadata = 3;
}

// Handshake initiated by the CEF client to the Java server
message HandshakeRequest {
  string client_id = 1; // client-provided id (e.g. process id or uuid)
  // Phase-7: client-supplied auth/token may be added here as a placeholder
  map<string, string> metadata = 2;
}

message HandshakeResponse {
  bool accepted = 1; // whether the server accepted the handshake
  string server_id = 2; // server identity (optional)
  string message = 3; // human-readable note
  map<string, string> metadata = 4; // server-side metadata, placeholder for Phase-7
}

// Request from Java -> CEF: open a page
message OpenPage {
  string url = 1;
  // optional client-visible label / target
  string target = 2;
  // placeholder metadata for Phase-7 features
  map<string, string> metadata = 3;
}

// Notification from CEF -> Java about page load/status
message PageStatus {
  string url = 1;
  enum Status {
    UNKNOWN = 0;
    LOADED = 1;
    FAILED = 2;
    CLOSED = 3;
  }
  Status status = 2;
  string details = 3; // optional error or additional info
  map<string, string> metadata = 4;
}

// Command request: CEF polls Java for pending commands (unary poll model)
message CommandRequest {
  string client_id = 1; // identifies which client is polling
  map<string, string> metadata = 2; // placeholder
}

// CommandResponse: server responds with at-most-one command using oneof
message CommandResponse {
  oneof command {
    OpenPage open_page = 1;
    // future commands can be added here
  }
  // if no command is available the server may return an empty response (no-oneof set)
  map<string, string> metadata = 2; // placeholder for Phase-7
}

// The IPC service exposed by the Java authority (server). All RPCs are unary.
service IpcService {
  // CEF -> Java: perform handshake
  rpc Handshake(HandshakeRequest) returns (HandshakeResponse) {}

  // CEF -> Java: notify page status (notifications implemented as unary calls)
  rpc SendPageStatus(PageStatus) returns (Ack) {}

  // CEF -> Java: poll for a single command (Java will return an OpenPage or empty)
  // This is the unary mechanism used to allow Java to "send" commands to CEF
  rpc GetCommand(CommandRequest) returns (CommandResponse) {}
}
